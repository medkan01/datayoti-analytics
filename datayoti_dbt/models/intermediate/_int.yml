models:
  - name: int_devices
    description: "Modèle intermédiaire pour les appareils avec des informations nettoyées et enrichies."
    columns:
      - name: device_source_id
        description: "Identifiant technique unique de l'appareil, issu de la source brute."
        tests:
          - not_null
          - unique
      - name: mac_addr
        description: "Adresse MAC de l'appareil. Correspond à l'identifiant métier utilisé."
        tests:
          - not_null
          - unique
      - name: site_source_id
        description: "Identifiant technique du site auquel l'appareil est associé, provenant de la source brute."
      - name: first_seen_ts
        description: "Horodatage du premier enregistrement de l'appareil."
      - name: last_seen_ts
        description: "Horodatage du dernier enregistrement de l'appareil."
  
  - name: int_hourly_sensor_health
    description: "Modèle intermédiaire pour les métriques de santé des capteurs agrégées par heure."
    columns:
      - name: device_id
        description: "Identifiant unique de l'appareil."
        tests:
          - not_null
      - name: event_hour_ts
        description: "Horodatage tronqué à l'heure pour l'agrégation des événements."
        tests:
          - not_null
      - name: avg_rssi_dbm
        description: "Moyenne du signal RSSI en dBm pour l'heure."
      - name: min_rssi_dbm
        description: "Valeur minimale du signal RSSI en dBm pour l'heure."
      - name: max_rssi_dbm
        description: "Valeur maximale du signal RSSI en dBm pour l'heure."
      - name: avg_free_heap_bytes
        description: "Moyenne de la mémoire heap libre en octets pour l'heure."
      - name: min_free_heap_bytes
        description: "Valeur minimale de la mémoire heap libre en octets pour l'heure."
      - name: max_free_heap_bytes
        description: "Valeur maximale de la mémoire heap libre en octets pour l'heure."
      - name: avg_min_heap_bytes
        description: "Moyenne du minimum de mémoire heap atteint en octets pour l'heure."
      - name: min_min_heap_bytes
        description: "Valeur minimale du minimum de mémoire heap atteint en octets pour l'heure."
      - name: max_min_heap_bytes
        description: "Valeur maximale du minimum de mémoire heap atteint en octets pour l'heure."
      - name: avg_uptime_secs
        description: "Moyenne du temps de fonctionnement en secondes pour l'heure."
      - name: min_uptime_secs
        description: "Valeur minimale du temps de fonctionnement en secondes pour l'heure."
      - name: max_uptime_secs
        description: "Valeur maximale du temps de fonctionnement en secondes pour l'heure."
      - name: first_reception_hour_ts
        description: "Premier horodatage de réception tronqué à l'heure."
      - name: last_reception_hour_ts
        description: "Dernier horodatage de réception tronqué à l'heure."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - device_id
            - event_hour_ts

  - name: int_hourly_sensor_reading
    description: "Modèle intermédiaire pour les lectures de capteurs (température et humidité) agrégées par heure."
    columns:
      - name: device_id
        description: "Identifiant unique de l'appareil."
        tests:
          - not_null
      - name: event_hour_ts
        description: "Horodatage tronqué à l'heure pour l'agrégation des événements."
        tests:
          - not_null
      - name: avg_temperature_celsius
        description: "Température moyenne en degrés Celsius pour l'heure."
      - name: min_temperature_celsius
        description: "Température minimale en degrés Celsius pour l'heure."
      - name: max_temperature_celsius
        description: "Température maximale en degrés Celsius pour l'heure."
      - name: avg_humidity_percentage
        description: "Humidité moyenne en pourcentage pour l'heure."
      - name: min_humidity_percentage
        description: "Humidité minimale en pourcentage pour l'heure."
      - name: max_humidity_percentage
        description: "Humidité maximale en pourcentage pour l'heure."
      - name: first_reception_hour_ts
        description: "Premier horodatage de réception tronqué à l'heure (métrique de qualité d'ingestion)."
      - name: last_reception_hour_ts
        description: "Dernier horodatage de réception tronqué à l'heure (métrique de qualité d'ingestion)."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - device_id
            - event_hour_ts