models:
  - name: stg_devices
    description: "Modèle de staging pour les appareils IoT avec nettoyage et standardisation des types de données."
    columns:
      - name: device_source_id
        description: "Identifiant technique unique de l'appareil (entier)."
        tests:
          - not_null
          - unique
      - name: device_mac_addr
        description: "Adresse MAC de l'appareil au format standard (XX:XX:XX:XX:XX:XX)."
        tests:
          - not_null
          - unique
          - valid_mac_address
      - name: site_ref
        description: "Référence du site auquel l'appareil est associé."
        tests:
          - not_null
      - name: created_ts
        description: "Horodatage de création de l'appareil dans le système."
        tests:
          - not_null
      - name: updated_ts
        description: "Horodatage de dernière mise à jour de l'appareil."
        tests:
          - not_null

  - name: stg_device_heartbeats
    description: "Modèle de staging pour les données de santé des appareils (heartbeats) avec nettoyage et standardisation."
    columns:
      - name: event_ts
        description: "Horodatage de l'événement heartbeat."
        tests:
          - not_null
      - name: device_mac_addr
        description: "Adresse MAC de l'appareil émetteur au format standard (XX:XX:XX:XX:XX:XX)."
        tests:
          - not_null
          - valid_mac_address
      - name: rssi_dbm
        description: "Puissance du signal reçu en dBm."
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -120
              max_value: 0
      - name: free_heap_bytes
        description: "Mémoire heap libre disponible en octets."
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1000000
      - name: uptime_secs
        description: "Temps de fonctionnement de l'appareil en secondes."
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
      - name: min_heap_bytes
        description: "Minimum de mémoire heap atteint en octets."
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1000000
      - name: ntp_sync
        description: "Indicateur de synchronisation NTP (true/false)."
      - name: reception_ts
        description: "Horodatage de réception du message par le broker."
        tests:
          - not_null

  - name: stg_sensor_data
    description: "Modèle de staging pour les données de capteurs (température et humidité) avec nettoyage et standardisation."
    columns:
      - name: event_ts
        description: "Horodatage de la mesure du capteur."
        tests:
          - not_null
      - name: device_mac_addr
        description: "Adresse MAC de l'appareil capteur au format standard (XX:XX:XX:XX:XX:XX)."
        tests:
          - not_null
          - valid_mac_address
      - name: temperature_celsius
        description: "Température mesurée en degrés Celsius."
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -50
              max_value: 80
      - name: humidity_percentage
        description: "Humidité relative mesurée en pourcentage."
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
      - name: reception_ts
        description: "Horodatage de réception du message par le broker."
        tests:
          - not_null

  - name: stg_sites
    description: "Modèle de staging pour les sites avec nettoyage et standardisation des types de données."
    columns:
      - name: site_source_id
        description: "Identifiant technique unique du site (entier), provenant de la source brute."
        tests:
          - not_null
          - unique
      - name: site_ref
        description: "Référence métier du site (code court)."
        tests:
          - not_null
          - unique
      - name: site_name
        description: "Nom du site."
      - name: site_description
        description: "Description détaillée du site."
      - name: created_ts
        description: "Horodatage de création du site dans le système."
        tests:
          - not_null
      - name: updated_ts
        description: "Horodatage de dernière mise à jour du site."
        tests:
          - not_null

  - name: stg_conformity_rules
    description: "Modèle de staging pour les règles de conformité métier avec nettoyage et standardisation des types de données. Les règles définissent les seuils acceptables pour différents types de métriques (température, humidité, stabilité, etc.) par site."
    columns:
      - name: rule_id
        description: "Identifiant technique unique de la règle de conformité (entier)."
        tests:
          - not_null
          - unique
      - name: site_ref
        description: "Référence du site auquel la règle s'applique (doit correspondre à un site_ref existant dans stg_sites)."
        tests:
          - not_null
      - name: metric_type
        description: "Type de métrique surveillée (temperature_range, humidity_ceiling, humidity_floor, temperature_stability, uptime_ratio, data_validity)."
        tests:
          - not_null
          - accepted_values:
              values: ['temperature_range', 'humidity_ceiling', 'humidity_floor', 'temperature_stability', 'uptime_ratio', 'data_validity']
      - name: min_allowed
        description: "Valeur minimale autorisée pour la métrique (NULL si pas de limite inférieure)."
        tests:
          - dbt_utils.accepted_range:
              min_value: -50
              max_value: 100
              inclusive: true
      - name: max_allowed
        description: "Valeur maximale autorisée pour la métrique (NULL si pas de limite supérieure)."
        tests:
          - dbt_utils.accepted_range:
              min_value: -50
              max_value: 100
              inclusive: true
      - name: criticality_level
        description: "Niveau de criticité de la règle (LOW, MEDIUM, HIGH)."
        tests:
          - not_null
          - accepted_values:
              values: ['LOW', 'MEDIUM', 'HIGH']
      - name: description
        description: "Description détaillée de la règle de conformité et de son impact métier."
        tests:
          - not_null
      - name: created_ts
        description: "Horodatage de création de la règle dans le système."
        tests:
          - not_null
      - name: updated_ts
        description: "Horodatage de dernière mise à jour de la règle."
        tests:
          - not_null